<div id="quick-view-popup" class="quick-view popup-hidden">
    <div class="quick-view-content">
        <button id="quick-view-close"><img src="{{ '/cross-icon.svg' | file_url }}" alt="close" width="18px" height="18px"></button>

        <div class="row">
            <div class="col-5">
                <img src="{{ '/dummy-image.jpg' | file_url }}" alt="image" id="quick-view-image" width="121px" height="150px" />
            </div>
            <div class="col-7">
                <h3 id="quick-view-title"></h3>
                <h4 id="quick-view-price">980,00â‚¬</h4>
                <p id="quick-view-desc">This one-piece swimsuit is crafted from jersey featuring an allover micro Monogram motif in relief.</p>
            </div>
        </div>
        <div class="colors-container">
            <h4>Color</h4>
            <div class="color-options">
                <div id="color-options-fill"></div>
            </div>
        </div>
        <div class="sizes-container">
            <h4>Size</h4>
            <div id="size-selector">
                <div id="size-selector-header">
                    <p>Choose your size</p>
                    <img src="{{ '/down-arrow.svg' | file_url }}" alt="arrow" width="37px" height="34px">
                </div>

                <div class="size-options">
                    <div id="size-options-fill"></div>
                </div>
            </div>
        </div>

        <button id="quick-view-add-to-cart">Add To Cart <img src="{{ '/right-icon.svg' | file_url }}" alt="arrow" width="20px" height="9px"></button>
    </div>
</div>

<style>
/*Quick View Popup*/
.quick-view {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #00000077;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100000;
    font-family: "Jost" !important;
}
.popup-hidden {
    display: none;
}
.quick-view-content {
    position: fixed;
    width: 300px;
    max-width: 100%;
    background: #fff;
    padding: 15px;
}
.quick-view #quick-view-close {
    float: right;
    background-color: transparent;
    border: none;
    position: relative;
    z-index: 100;
    cursor: pointer;
}
.quick-view .row {
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    align-items: center;
    margin-top: 20px;
}
.quick-view .row .col-5 {
    -ms-flex: 0 0 calc(48% - 15px);
    flex: 0 0 calc(48% - 15px);
    max-width: calc(48% - 15px);
    padding-right: 15px;
}
.quick-view .row .col-7 {
    -ms-flex: 0 0 52%;
    flex: 0 0 52%;
    max-width: 52%;
}
.quick-view .row .col-5 img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    object-position: center center;
}

.quick-view .row .col-7 h3 {
    font-weight: 300;
    margin-bottom: 15px;
}
.quick-view .row .col-7 h4 {
    font-weight: 400;
    font-size: 16px;
    margin-bottom: 10px;
    font-family: "Lustria";
    font-weight: 300;
}
.quick-view .row .col-7 p {
    font-weight: 300;
    font-size: 12px;
}
.quick-view .colors-container h4 {
    font-weight: 400;
    font-size: 14px;
    color: #333333;
    margin-bottom: 2px;
}
.quick-view .sizes-container h4 {
    font-weight: 400;
    font-size: 14px;
    color: #333333;
    margin-bottom: 2px;
}
.quick-view .sizes-container #size-selector-header {
    border: 1px solid #000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}
.quick-view .sizes-container #size-selector-header p {
    padding: 0 10px;
}
.quick-view .sizes-container #size-selector-header img {
    border-left: 1px solid #000;
    padding: 12px 10px;
}

.quick-view #quick-view-add-to-cart {
    display: flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    background: #000000;
    padding: 12px 30px;
    text-transform: uppercase;
    color: #ffffff;
    width: max-content;
    font-size: 12px;
    font-weight: 300;
    border: 0;
    width: 100%;
    margin-top: 50px;
    margin-bottom: 2px;
}
.quick-view #quick-view-add-to-cart img {
    width: 20px;
    margin-left: 20px;
    filter: invert(1);
}

/*Quick View Color Options*/
.quick-view .colors-container {
    position: relative;
    z-index: 100;
    margin-bottom: 10px;
}
.quick-view #color-options-fill {
    display: flex;
    justify-content: space-between;
}
.quick-view .color-options input {
    display: none;
}
.quick-view .color-options label {
    width: 50%;
    border: 1px solid #000000;
    padding: 5px 15px;
}
.quick-view .color-options label.checked {
    background: #000000;
    color: #FFFFFF;
}
.quick-view .color-options label:nth-child(even) {
    border-left: 0;
}
.quick-view .color-options label {
    position: relative;
}
.quick-view .color-options label div {
    content: " ";
    display: block;
    width: 5px;
    height: 100%;
    position: absolute;
    border-right: 1px solid #000;
    top: 0;
    left: 0;
}

/*Quick View Size Options*/
.quick-view .sizes-container {
    position: relative;
    z-index: 100;
}
.quick-view .size-options {
    position: absolute;
    width: 100%;
    background: #fff;
    max-height: 70px;
    overflow-y: scroll;
    scrollbar-width: none;
}
.quick-view .size-options::-webkit-scrollbar {
    display: none;
}
.quick-view #size-options-fill {
    border: 1px solid #000000;
    border-top: 0;
}
.quick-view .size-options input {
    display: none;
}
.quick-view .size-options label {
    display: block;
    text-align: center;
    font-size: 15px;
    padding: 5px;
}
.quick-view .size-options label:hover {
    background: #000;
    color: #fff;
}
.quick-view .size-options label:last-child {
    padding-bottom: 0;
}
.quick-view #size-selector .size-options {
    max-height: 0;
    transition: max-height 0.2s ease;
}
.quick-view #size-selector.active .size-options {
    max-height: 87px;
}
</style>


<script>
    (function () {
        const popup = document.getElementById("quick-view-popup");
        const closeBtn = document.getElementById("quick-view-close");
        const addToCartBtn = document.getElementById("quick-view-add-to-cart")
        const sizeSelectorHeader = document.getElementById("size-selector-header");

        //Open
        document.querySelectorAll(".quick-view-trigger").forEach((btn) => {
            btn.addEventListener("click", function () {
                popup.classList.remove("popup-hidden");

                //Fetch Content
                fetch(`/products/blue-silk-tuxedo.js`)
                .then(res => res.json())
                .then(product => {
                    // Fill content
                    window.shopifyCurrencySymbol = "{{ 1 | money | slice: 0, 1 }}";
                    document.getElementById("quick-view-title").innerText = product.title;
                    document.getElementById("quick-view-price").innerText = (product.price / 100).toFixed(2) + ' ' + window.shopifyCurrencySymbol;
                    document.getElementById("quick-view-desc").innerHTML = product.description;
                    document.getElementById("quick-view-image").src = product.featured_image;

                    //Color Options
                    const colorContainer = document.getElementById("color-options-fill");
                    colorContainer.innerHTML = "";

                    let colorOption = product.options.find(opt => opt.name.toLowerCase() === "color");
                    if(colorOption) {
                        colorOption.values.forEach(val => {
                            let label = document.createElement("label");
                            let radio = document.createElement("input");
                            radio.type = "radio";
                            radio.name = "color";
                            radio.value = val;
                            let colorhex = document.createElement("div");
                            if(val === "Black") {
                                colorhex.style.backgroundColor = "#000000";
                            } else if(val === "White") {
                                colorhex.style.backgroundColor = "#FFFFFF";
                            } else if(val === "Red") {
                                colorhex.style.backgroundColor = "#B20F36";
                            } else if(val === "Blue") {
                                colorhex.style.backgroundColor = "#0D499F";
                            } else {
                                colorhex.style.backgroundColor = "#AFAFB7";
                            }
                            label.appendChild(colorhex);
                            label.appendChild(radio);
                            label.appendChild(document.createTextNode(val));
                            radio.addEventListener("change", function () {
                                document.querySelectorAll("#color-options-fill label").forEach(l => l.classList.remove("checked"));
                                if (radio.checked) {
                                    label.classList.add("checked");
                                }
                            });
                            colorContainer.appendChild(label);
                        });
                    }

                    //Size Options
                    const sizeContainer = document.getElementById("size-options-fill");
                    sizeContainer.innerHTML = "";

                    let sizeOption = product.options.find(opt => opt.name.toLowerCase() === "size");
                    if(sizeOption) {
                        sizeOption.values.forEach(val => {
                            let label = document.createElement("label");
                            let radio = document.createElement("input");
                            radio.type = "radio";
                            radio.name = "size";
                            radio.value = val;
                            label.appendChild(radio);
                            label.appendChild(document.createTextNode(val));
                            radio.addEventListener("change", function () {
                                if (radio.checked) {
                                    document.querySelector("#size-selector-header p").innerText = val;
                                    document.getElementById("size-selector").classList.remove("active");
                                }
                            });
                            sizeContainer.appendChild(label);
                        });
                    }

                    //Add to Cart
                    addToCartBtn.onclick = function() {
                        let selectedColor = document.querySelector("input[name="color"]:checked")?.value;
                        let selectedSize = document.querySelector("input[name="size"]:checked")?.value;

                        let variant = product.variants.find(v => {
                            return (!selectedColor || v.options.includes(selectedColor)) && (!selectedSize || v.options.includes(selectedSize));
                        });

                        if(!variant) {
                            alert("Please select options");
                            return;
                        }

                        fetch("/cart/add.js", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ id: variant.id, quantity: 1 })
                        })
                        .then(() => {
                            alert("Added to Cart");
                            popup.classList.add("popup-hidden");
                        });
                    };
                });
            });
        });

        //Close
        closeBtn.addEventListener("click", () => {
            popup.classList.add("popup-hidden");
        });

        //Close on outside click
        window.addEventListener("click", (e) => {
            if (e.target === popup) {
                popup.classList.add("popup-hidden");
            }
        });

        //Size Selector Toggle
        sizeSelectorHeader.addEventListener("click", () => {
            const sizeSelector = document.getElementById("size-selector");
            sizeSelector.classList.toggle("active");
        });
    })();
</script>